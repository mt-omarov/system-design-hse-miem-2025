# Сбор и анализ требований

## Задание

[kata link](https://www.architecturalkatas.com/kata.html?kata=YouLookGoodInPrint.json)

### Оригинал

**You Look Good In Print**<br>
A local copy shop chain wants to offer its customers an "all-in-one" computing experience:<br>
document creation, editing, storage and printing.

Requirements:
- browser-based or –delivered;
- word processing;
- presentations;
- document templates (as start points);
- versioning;
- print scheduling;
- automatic and manual payment.

Users: initially, thousands in the local city, but potentially millions if the demand grows.

### Перевод

**You Look Good In Print**<br>
Местная сеть копировальных салонов хочет предложить своим клиентам "все-в-одном":<br>
создание, редактирование, хранение и печать документов

Требования:
- работа через браузер или через приложение;
- обработка текстов;
- презентации;
- шаблоны документов (как отправные точки);
- версионирование;
- планирование печати;
- автоматическая и ручная оплата.

Пользователи: первоначально тысячи в местном городе, но потенциально миллионы,
если спрос вырастет.

## Отсев

1. Хранение документов

    - Где будут храниться документы пользователей: в арендуемом облаке или на личных серверах?<br>
    Стоит заметить, что даже на ограниченное количество пользователей
    (если они будут активно пользоваться платформой) потребуется много ресурсов.<br>
    При большом количестве пользователей (тысячи и миллионы) и использовании своих серверов потребуется
    регулярно проводить диагностику серверного оборудования, нанимать для этого постоянный персонал и пр.

    - Кроме того, поскольку документы для пользователей могут быть важными, нужно обеспечить
    их резервное копирование: серверное оборудование может ломаться, память безвовзратно портиться.<br>

    - Не задумывались ли вы об ограничениях для пользователей?<br>
    Например, ограниченный размер памяти на пользователя и/или ограничение на объем документа,
    и возможность оформить подписку для ее увеличения (в разумных пределах)?<br>
    Это позволит значительно сократить возможные расходы в будущем.

    - При всех вышеупомянутых сложностях, уверены ли вы в продолжении разработки такой масштабной платформы?

2. Создание приложения

    - Под какие ОС вы нацелены разрабатывать приложение?<br>
    Создание приложения это, как правило, совершенно другая задача, чем создание сайта.
    Это буквально другой проект, который потребует другой подход, другие технологии и разных специалистов.

    - На рынке основными системами выступают Windows, Linux (Unix-системы) и macOS.<br>
    Поддерживать сразу все три может усложнить проект и замедлить его.
    Кроме того, разработка приложения потребует его постоянной поддержки:
        - улучшения для совместимости с сайтом,
        - исправление возможных ошибок,
        - адаптация под измененения в самих ОС.
    Все это потребует нанимать команды специалистов на длительный период.

    - Уверены ли вы, что хотите создавать приложение?

3. Планирование печати

    - Будете ли вы расставлять приоритеты между клиентами, которые пользуются сервисом,
    и теми, кто им не пользуется и зашел в салон без брони? Как вы собираетесь обслуживать
    вторую категорию клиентов, если бронь будет расписана на весь оставшийся день?

    - Для возможности обслужить клиентов, которые пришли по живой очереди, стоит ли
    вырезать некоторую часть часов из системы бронирования?

    - Для возможности бронирования салонам будет полезно получать информацию об этом.
    Это потребует разрабатывать функционал для самих работников салона и потребует больше времени.

    - В связи с этим, уверены ли вы в необходимости разрабатывать этот функционал?

## Scope Refinement

1. 3 типа пользователей:
    - клиент,
    - администратор,
    - продавец: отслеживание брони (?).

2. Браузерное приложение (сайт) с возможностью:
    - создавать и вести документы двух категорий: документы формата А4, презентации;
    - при создании документов первой категории выбирать готовые шаблоны;
    - перемещаться между изменениями содержимого документа (версионирование)
    и выбирать среди них новое текущее состояние (голову ветки);
    - просматривать доступное время для печати в конкретном салоне;
    - бронировать свободное время для печати в выбранном салоне;
    - просматривать текущие тарифы печати;
    - оплачивать печать через сайт: оплата через реквизиты, СБП;
    - опционально:
        - интегрировать просмотр карты для выбора салона при бронировании;
        - возможность работникам салонов просматривать бронирование печати своего салона.

3. Административная часть сайта с возможностью:
    - редактировать информацию о салонах (адрес, название, брони);
    - получать статистику о количестве работ в салонах.

## Функциональные требования

1. Регистрация и авторизация
    - регистрация по электронной почте,
    - верификация электронной почты при регистрации,
    - восстановление пароля через почту,
    - авторизация с указанием почты и пароля.

2. Управление документами
    - просмотр существующих документов в базе пользователя,
    - создание пустого документа или выбор шаблона,
    - редактирование текста документа, вставка изображений, таблиц,
    - автоматическое сохранение изменений каждую минуту,
    - история версий документа: возможность перемещаться между определенными
    сохранениями (версиями) документа,
    - ограничение на размер одного документа - 4 Мб,
    - ограничение на размер хранилища пользователя - 10 документов,
    - оформление подписки для увеличения максимального размера документа до 32 Мб
    и максимального размера хранилища до 50 документов.

3. Бронирование времени печати
    - выбор ближайшего салона на карте (с определением геолокации),
    - просмотр свободных временных слотов на ближайшие 7 дней,
    - бронирование слота для конкретного документа,
    - возможность отменить бронирование не позднее чем за 1 час до ее начала.

4. Оплата
    - возможность в разделе оплаты изучить текущий тариф печати,
    - возможность оплаты онлайн (банковская карта или СБП),
    - выставление электронного чека на почту пользователя.

5. Работа сотрудников
    - сотрудник салона может просмотреть список предстоящих печатей со статусом оплаты:
    "оплачен" или "требует оплаты",
    - сотрудник подтверждает статус заказа: "в печати", "готов", "выдан".

6. Администрирование
    - добавление новых салонов и сотрудников, редактирование существующих салонов и учетных записей 
    сотрудников через интерфейс администратора,
    - управление расписанием работы салонов,
    - изменение тарифа печати.

## Нефункциональные требования

1. Производительность
    - ответ на создание/открытие/переход между разделами составляет не более 2 секунд
    при нормальной нагрузке,
    - ответ на редактирование содержимого документа происходит без видимых задержек,
    - ответ на сохранение документа составляет не более 1 секунды при нормальной нагрузке.

2. Масштабируемость
    - возможность увеличения числа пользователей без серьезных изменений в архитектуре системы.

3. Безопасность
    - защита данных пользователей: шифрование трафика и данных в храналище, 
    - аутентификация и авторизация пользователей,
    - защита платежей.

4. Надежность
    - автоматическое резервное копирование документов раз в день (ночью).

5. Совместимость
    - совместимость минимум с 2 последними версиями Chrome, Safari и Firefox,
    - возможность удобного использования на планшетах и мобильных устройствах.

## Ограничения

1. Работа только через браузер.
2. Ограничение на использование облачного хранилища до определенного бюджета в месяц.
3. Ограничение на память пользователя:
    - базовый план: 4 Мб на документ, 10 документов => 40 Мб на пользователя,
    - расширенный план: 32 Мб на документ, 50 документов => 1600 Мб на пользователя.
4. Доступность сервера в пределах города (в начале).
5. Время разработки: MVP в течение 6 месяцев.

## Расчет нагрузки

### Трафик

1. Исходные предположения:
    - в городе 10 000 пользователей,
    - активность: 20% пользователей используют систему в любой момент времени,
    - средняя работа над текстами в режиме редактирования на пользователя – 1 час в день,
    - среднее количество операций бронирование и оплата – 2 операции в день на пользователя.

2. Расчеты:
    - 10 000 * 20% = 2 000 активных пользователей одновременно,
    - 10 000 * (2 + 60) = 62 000 операций в день,
        - где 60 – это количество операций сохранения на 1 час времени (автосохранения раз в минуту).
        - 2 – количество операций бронирования и опталы на пользователя в день.

3. Пиковая нагрузка – рассчитывается как 25% от всех операций в день за 2 часа (утренние и вечерние часы):
    - 62 000 / 4 = 15 500 операций за 2 часа,
    - 15 500 / 2700 ≈ 2.2 операций в секунду.

### БД

1. Хранение пользователей:
    - ID – уникальный идентификатор, UUID – 16 байт,
    - Имя – имя пользователя, строка varchar до 50 символов – 50 байт (utf-8),
    - Почта – строка varchar – 50 байт,
    - Пароль – хеш от пароля, строка фиксированной длины – 64 байта (SHA-256).

    Итого: 16 + 50 + 50 + 64 = 180 байт.
    Для учета индексации округляется до 200 байт.

2. Хранение документов:
    - текст документа – средний вес от максимума – 500 Кб (допущение),
    - версии документа – до 10 версий, простое копирование документа – 5 Мб.

    Итого на документ: 5.5 Мб.

3. Таблица бронирования:
    - ID бронирования – 16 байт,
    - ID салона – 16 байт,
    - дата и время начала бронирования – timestamp, 8 байт,
    - ID пользователя – 16 байт.

    > Специфика бронирования:
    > - рабочее время салона: 9:00-20:00 (11 часов),
    > - 1 час отводится на обед для сотрудников – 10 часов рабочего времени,
    > - 2 часа суммарно отводится на клиентов без брони – 8 часов для бронирования,
    > - слот бронирования имеет фиксированную длительность в 15 минут:<br>
        (8 * 60 минут) / 15 = 32 бронирования в день на 1 салон.

    Итого: 58 байт на бронь, можно округлить до 100 байт для учета индексации.

4. Таблица платежей:
    - ID платежа – 16 байт,
    - Сумма – 8 байт,
    - Статус (оплачен/ожидает/ошибка) – 10 байт,
    - ID пользователя – 16 байт,
    - ID документа – 16 байт,
    - ID бронирования – 16 байт.

    Итого: 16 * 4 + 8 + 10 = 82 байта. С учетом выравнивания структур
    и индексации можно округлить до 100 байт.

#### Выводы
- (10 000 пользователей) * (информация о пользователе = 200 байт) ≈ 2 Мб,
- (10 000 пользователей) * (информация о документе = 5.5 Мб) * (кол-во на пользователя = 10) ≈ 537 Гб,
- (5 салонов на город) * (32 брони) * (размер брони = 100 байт) * (7 дней) ≈ 110 Кб
- (5 салонов на город) * (32 брони) * (размер платежа = 100 байт) * (7 дней) ≈ 110 Кб

Итого при максимальной загруженности сервера ≈ 538 Гб.
